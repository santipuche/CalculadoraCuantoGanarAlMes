<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e40af">
    <title>FinanzasPro | Gestión de Presupuesto</title>
    
    <link rel="icon" type="image/jpeg" href="https://i.postimg.cc/jd7vBPRB/478b64ec61ff4533a5418e6244be480d.jpg">

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script crossorigin src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script crossorigin src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { margin: 0; font-family: sans-serif; overscroll-behavior: contain; }
        .dark { background-color: #0f172a; color: white; }
        #root { min-height: 100vh; }
        input, select { min-height: 40px; font-size: 16px !important; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse { animation: pulse 2s infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Extraer componentes de las librerías globales
        const { useState, useEffect, useMemo } = React;
        const { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } = window.Recharts;

        // Componente de Iconos SVG (Simple)
        const Icon = ({ name, size = 24, className = '' }) => {
            const icons = {
                'plus-circle': 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zm1-11h4m-5 0V7m0 4v4',
                'trash-2': 'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2m-6 5v6m4-6v6',
                'dollar-sign': 'M12 1v22m5-18H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6',
                'pie-chart': 'M21.21 15.89A10 10 0 118 2.83M22 12A10 10 0 0012 2v10z',
                'moon': 'M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z',
                'sun': 'M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41',
                'rotate-ccw': 'M1 4v6h6M3.51 15a9 9 0 102.13-9.36L1 10'
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={icons[name] || ''} />
                </svg>
            );
        };

        function App() {
            const [transacciones, setTransacciones] = useState([]);
            const [modoOscuro, setModoOscuro] = useState(false);
            const [mostrarConfirmacion, setMostrarConfirmacion] = useState(false);
            const [cargando, setCargando] = useState(true);

            // Cargar datos
            useEffect(() => {
                const trs = localStorage.getItem('transacciones');
                const dark = localStorage.getItem('modoOscuro');
                if (trs) setTransacciones(JSON.parse(trs));
                if (dark) setModoOscuro(JSON.parse(dark));
                setCargando(false);
            }, []);

            // Guardar datos
            useEffect(() => {
                if (!cargando) {
                    localStorage.setItem('transacciones', JSON.stringify(transacciones));
                    localStorage.setItem('modoOscuro', JSON.stringify(modoOscuro));
                }
            }, [transacciones, modoOscuro, cargando]);

            const agregarTransaccion = () => {
                const hoy = new Date().toISOString().split('T')[0];
                setTransacciones([...transacciones, { 
                    tipo: 'gasto', categoria: 'casa', concepto: '', monto: 0, interes: 0, fecha: hoy 
                }]);
            };

            const actualizarTransaccion = (index, campo, valor) => {
                const nuevas = [...transacciones];
                if (campo === 'monto' || campo === 'interes') {
                    nuevas[index][campo] = parseFloat(valor) || 0;
                } else if (campo === 'tipo') {
                    nuevas[index].tipo = valor;
                    nuevas[index].categoria = valor === 'gasto' ? 'casa' : valor === 'ingreso' ? 'salario' : 'prestamo';
                } else {
                    nuevas[index][campo] = valor;
                }
                setTransacciones(nuevas);
            };

            // Cálculos
            const calcTotal = (t) => t.tipo === 'deuda' ? (t.monto + (t.monto * (t.interes || 0) / 100)) : t.monto;
            
            const resumen = useMemo(() => {
                const ingresos = transacciones.filter(t => t.tipo === 'ingreso').reduce((s, t) => s + t.monto, 0);
                const gastos = transacciones.filter(t => t.tipo === 'gasto').reduce((s, t) => s + t.monto, 0);
                const deudas = transacciones.filter(t => t.tipo === 'deuda').reduce((s, t) => s + calcTotal(t), 0);
                return { ingresos, gastos, deudas, balance: ingresos - gastos - deudas };
            }, [transacciones]);

            const prepararDatos = (tipo) => {
                const data = {};
                transacciones.filter(t => t.tipo === tipo).forEach(t => {
                    const cat = t.categoria || 'Otro';
                    data[cat] = (data[cat] || 0) + calcTotal(t);
                });
                return Object.entries(data).map(([name, value]) => ({ name, value }));
            };

            if (cargando) return <div className="flex h-screen items-center justify-center">Cargando...</div>;

            return (
                <div className={`${modoOscuro ? 'dark' : ''}`}>
                    <div className="min-h-screen bg-slate-50 dark:bg-slate-900 p-4 transition-colors">
                        <div className="max-w-4xl mx-auto">
                            {/* Header */}
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-2xl font-bold text-blue-600 flex items-center gap-2">
                                    <Icon name="dollar-sign" /> FinanzasPro
                                </h1>
                                <div className="flex gap-2">
                                    <button onClick={() => setMostrarConfirmacion(true)} className="p-2 bg-red-500 text-white rounded-lg"><Icon name="rotate-ccw" size={20}/></button>
                                    <button onClick={() => setModoOscuro(!modoOscuro)} className="p-2 bg-slate-200 dark:bg-slate-700 rounded-lg">
                                        <Icon name={modoOscuro ? 'sun' : 'moon'} size={20}/>
                                    </button>
                                </div>
                            </div>

                            {/* Cards */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div className="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border-l-4 border-green-500">
                                    <p className="text-xs text-slate-500">Ingresos</p>
                                    <p className="text-lg font-bold">${resumen.ingresos.toFixed(2)}</p>
                                </div>
                                <div className="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border-l-4 border-red-500">
                                    <p className="text-xs text-slate-500">Gastos</p>
                                    <p className="text-lg font-bold">${resumen.gastos.toFixed(2)}</p>
                                </div>
                                <div className="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border-l-4 border-yellow-500">
                                    <p className="text-xs text-slate-500">Deudas</p>
                                    <p className="text-lg font-bold">${resumen.deudas.toFixed(2)}</p>
                                </div>
                                <div className={`bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border-l-4 ${resumen.balance >= 0 ? 'border-blue-500' : 'border-orange-500'}`}>
                                    <p className="text-xs text-slate-500">Balance</p>
                                    <p className="text-lg font-bold">${resumen.balance.toFixed(2)}</p>
                                </div>
                            </div>

                            {/* Graficos */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div className="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm h-64">
                                    <h3 className="text-sm font-bold mb-4">Distribución de Gastos</h3>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie data={prepararDatos('gasto')} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={50}>
                                                {prepararDatos('gasto').map((e, i) => <Cell key={i} fill={['#ef4444', '#f87171', '#b91c1c'][i % 3]} />)}
                                            </Pie>
                                            <Tooltip />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>
                                <div className="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm h-64">
                                    <h3 className="text-sm font-bold mb-4">Ingresos vs Gastos</h3>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie data={[{name: 'Ingresos', value: resumen.ingresos}, {name: 'Egresos', value: resumen.gastos + resumen.deudas}]} dataKey="value" cx="50%" cy="50%" innerRadius={40} outerRadius={60}>
                                                <Cell fill="#10b981" /><Cell fill="#ef4444" />
                                            </Pie>
                                            <Tooltip />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            {/* Transacciones */}
                            <div className="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm">
                                <div className="flex justify-between mb-4">
                                    <h2 className="font-bold">Transacciones</h2>
                                    <button onClick={agregarTransaccion} className="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm flex items-center gap-1">
                                        <Icon name="plus-circle" size={16}/> Añadir
                                    </button>
                                </div>
                                <div className="space-y-3">
                                    {transacciones.map((t, i) => (
                                        <div key={i} className="flex flex-col p-3 border dark:border-slate-700 rounded-xl gap-2">
                                            <div className="flex gap-2">
                                                <input type="date" value={t.fecha} onChange={e => actualizarTransaccion(i, 'fecha', e.target.value)} className="bg-transparent text-xs w-full" />
                                                <select value={t.tipo} onChange={e => actualizarTransaccion(i, 'tipo', e.target.value)} className="bg-transparent text-xs font-bold">
                                                    <option value="gasto">Gasto</option>
                                                    <option value="ingreso">Ingreso</option>
                                                    <option value="deuda">Deuda</option>
                                                </select>
                                                <button onClick={() => setTransacciones(transacciones.filter((_, idx) => idx !== i))} className="text-red-500"><Icon name="trash-2" size={16}/></button>
                                            </div>
                                            <div className="flex gap-2">
                                                <input type="text" placeholder="Concepto" value={t.concepto} onChange={e => actualizarTransaccion(i, 'concepto', e.target.value)} className="bg-slate-100 dark:bg-slate-700 p-2 rounded text-sm flex-1" />
                                                <input type="number" placeholder="Monto" value={t.monto || ''} onChange={e => actualizarTransaccion(i, 'monto', e.target.value)} className="bg-slate-100 dark:bg-slate-700 p-2 rounded text-sm w-24" />
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Modal */}
                        {mostrarConfirmacion && (
                            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white dark:bg-slate-800 p-6 rounded-2xl max-w-sm w-full">
                                    <p className="font-bold mb-4">¿Reiniciar todos los datos?</p>
                                    <div className="flex justify-end gap-2">
                                        <button onClick={() => setMostrarConfirmacion(false)} className="px-4 py-2">No</button>
                                        <button onClick={() => { localStorage.clear(); location.reload(); }} className="px-4 py-2 bg-red-600 text-white rounded-xl">Sí, borrar</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

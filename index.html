<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FinanzasPro Argentina</title>
    
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/552/552791.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-950">
    <div id="root">
        <div id="loader" class="h-screen flex items-center justify-center text-white font-sans text-center p-6">
            <div>
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p class="text-xl font-bold">Iniciando FinanzasPro...</p>
                <p class="text-sm opacity-50 mt-2">Si esta pantalla no desaparece, revisa tu conexión.</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        // Intentar capturar errores de ejecución
        try {
            const { useState, useEffect } = React;
            
            // Acceso seguro a Recharts desde el CDN
            const { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } = window.Recharts;

            function App() {
                const [transacciones, setTransacciones] = useState([]);
                const [cargando, setCargando] = useState(true);

                useEffect(() => {
                    const saved = localStorage.getItem('finanzas_data');
                    if (saved) setTransacciones(JSON.parse(saved));
                    setCargando(false);
                    // Quitar el cargador manual una vez que React tome el control
                    document.getElementById('loader')?.remove();
                }, []);

                useEffect(() => {
                    if (!cargando) localStorage.setItem('finanzas_data', JSON.stringify(transacciones));
                }, [transacciones, cargando]);

                const total = transacciones.reduce((acc, t) => t.tipo === 'ingreso' ? acc + t.monto : acc - t.monto, 0);

                return (
                    <div className="min-h-screen bg-slate-950 text-white p-6 font-sans">
                        <header className="mb-8">
                            <h1 className="text-3xl font-black text-blue-500">FinanzasPro</h1>
                            <p className="opacity-50">App para Argentina</p>
                        </header>

                        <div className="bg-blue-600 p-8 rounded-[2rem] text-center mb-8 shadow-2xl shadow-blue-500/20">
                            <p className="text-xs uppercase font-bold tracking-widest mb-1">Saldo Disponible</p>
                            <h2 className="text-5xl font-black">${total.toLocaleString()}</h2>
                        </div>

                        <button 
                            onClick={() => setTransacciones([...transacciones, {tipo: 'gasto', monto: 1000, fecha: new Date().toLocaleDateString()}])}
                            className="w-full bg-slate-800 p-4 rounded-2xl font-bold mb-6 border border-white/5"
                        >
                            + Prueba rápida de gasto ($1.000)
                        </button>

                        <div className="space-y-4">
                            {transacciones.map((t, i) => (
                                <div key={i} className="bg-white/5 p-4 rounded-2xl flex justify-between border border-white/5">
                                    <span>Gasto de prueba</span>
                                    <span className="font-bold text-red-400">-${t.monto}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);

            // Registro de Service Worker con ruta relativa
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log("SW no registrado"));
            }
        } catch (error) {
            document.getElementById('root').innerHTML = `
                <div style="color: white; padding: 20px; font-family: sans-serif;">
                    <h1>Error detectado:</h1>
                    <p>${error.message}</p>
                </div>
            `;
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mi Calculadora Financiera 2026</title>
    <!-- Iconos y PWA -->
    <link rel="apple-touch-icon" href="i.postimg.cc">
    <link rel="icon" href="i.postimg.cc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Librerías Externas -->
    <script src="unpkg.com"></script>
    <script src="unpkg.com"></script>
    <script src="unpkg.com"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="unpkg.com"></script>
    <script src="unpkg.com"></script>

    <style>
        body { margin: 0; font-family: sans-serif; }
        #root { min-height: 100vh; }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } = Recharts;

        // Componente de Iconos Lucide
        const Icon = ({ name, size = 24, className = "" }) => {
            return <i data-lucide={name} style={{width: size, height: size}} className={className}></i>;
        };

        const App = () => {
            const [transacciones, setTransacciones] = useState([]);
            const [modoOscuro, setModoOscuro] = useState(false);
            const [cargando, setCargando] = useState(true);

            // Categorías predefinidas
            const catGastos = { casa: 'Casa', alimento: 'Alimento', transporte: 'Transporte', varios: 'Varios' };
            const catIngresos = { salario: 'Salario', freelance: 'Freelance', otros: 'Otros' };
            const catDeudas = { prestamo: 'Préstamo', tarjeta: 'Tarjeta', otros: 'Otros' };

            useEffect(() => {
                const saved = localStorage.getItem('finanzas_data');
                if (saved) setTransacciones(JSON.parse(saved));
                setCargando(false);
                setTimeout(() => lucide.createIcons(), 500);
            }, []);

            useEffect(() => {
                localStorage.setItem('finanzas_data', JSON.stringify(transacciones));
                lucide.createIcons();
            }, [transacciones]);

            const agregar = () => {
                setTransacciones([...transacciones, { 
                    id: Date.now(), tipo: 'gasto', categoria: 'casa', concepto: '', monto: 0, interes: 0 
                }]);
            };

            const eliminar = (id) => setTransacciones(transacciones.filter(t => t.id !== id));

            const edit = (id, campo, valor) => {
                setTransacciones(transacciones.map(t => t.id === id ? { ...t, [campo]: valor } : t));
            };

            const calcDeuda = (m, i) => (parseFloat(m) || 0) * (1 + (parseFloat(i) || 0) / 100);

            const tIngresos = transacciones.filter(t => t.tipo === 'ingreso').reduce((s, t) => s + (parseFloat(t.monto) || 0), 0);
            const tGastos = transacciones.filter(t => t.tipo === 'gasto').reduce((s, t) => s + (parseFloat(t.monto) || 0), 0);
            const tDeudas = transacciones.filter(t => t.tipo === 'deuda').reduce((s, t) => s + calcDeuda(t.monto, t.interes), 0);
            const balance = tIngresos - tGastos - tDeudas;

            const bg = modoOscuro ? 'bg-slate-900 text-white' : 'bg-gray-50 text-slate-900';
            const card = modoOscuro ? 'bg-slate-800' : 'bg-white';

            return (
                <div className={`min-h-screen ${bg} p-4 sm:p-8`}>
                    <div className="max-w-4xl mx-auto">
                        <header className="flex justify-between items-center mb-8">
                            <h1 className="text-2xl font-bold">Finanzas Personales</h1>
                            <button onClick={() => setModoOscuro(!modoOscuro)} className="p-2 rounded-full bg-slate-200 dark:bg-slate-700">
                                <Icon name={modoOscuro ? "sun" : "moon"} size={20} />
                            </button>
                        </header>

                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center">
                            <div className="p-4 bg-green-100 text-green-800 rounded-xl">
                                <p className="text-xs uppercase font-bold">Ingresos</p>
                                <p className="text-xl font-black">${tIngresos.toFixed(2)}</p>
                            </div>
                            <div className="p-4 bg-red-100 text-red-800 rounded-xl">
                                <p className="text-xs uppercase font-bold">Gastos</p>
                                <p className="text-xl font-black">${tGastos.toFixed(2)}</p>
                            </div>
                            <div className="p-4 bg-yellow-100 text-yellow-800 rounded-xl">
                                <p className="text-xs uppercase font-bold">Deudas</p>
                                <p className="text-xl font-black">${tDeudas.toFixed(2)}</p>
                            </div>
                            <div className={`p-4 rounded-xl ${balance >= 0 ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'}`}>
                                <p className="text-xs uppercase font-bold">Balance</p>
                                <p className="text-xl font-black">${balance.toFixed(2)}</p>
                            </div>
                        </div>

                        <div className={`${card} p-6 rounded-2xl shadow-xl mb-8`}>
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-xl font-bold">Transacciones</h2>
                                <button onClick={agregar} className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                                    <Icon name="plus" size={18} /> Agregar
                                </button>
                            </div>
                            
                            <div className="space-y-4">
                                {transacciones.map(t => (
                                    <div key={t.id} className="flex flex-col md:flex-row gap-2 p-3 border rounded-lg">
                                        <select value={t.tipo} onChange={(e) => edit(t.id, 'tipo', e.target.value)} className="bg-transparent border rounded p-1 text-sm">
                                            <option value="gasto">Gasto</option>
                                            <option value="ingreso">Ingreso</option>
                                            <option value="deuda">Deuda</option>
                                        </select>
                                        <input type="text" placeholder="Concepto" value={t.concepto} onChange={(e) => edit(t.id, 'concepto', e.target.value)} className="flex-1 bg-transparent border rounded p-1 text-sm" />
                                        <input type="number" placeholder="Monto" value={t.monto} onChange={(e) => edit(t.id, 'monto', e.target.value)} className="w-24 bg-transparent border rounded p-1 text-sm" />
                                        {t.tipo === 'deuda' && (
                                            <input type="number" placeholder="% Int" value={t.interes} onChange={(e) => edit(t.id, 'interes', e.target.value)} className="w-16 bg-transparent border rounded p-1 text-sm" />
                                        )}
                                        <button onClick={() => eliminar(t.id)} className="text-red-500 p-1">
                                            <Icon name="trash-2" size={18} />
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
